{
  "kind": "build_request",
  "title": "Fix frontend production build/deployment and retry build",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Restore the missing frontend build configuration required for production builds by adding `frontend/vite.config.ts` and `frontend/tsconfig.json` (and any other required root frontend config files) so the frontend can compile successfully in the deployment environment.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "try again"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/vite.config.ts` exists and is valid for a Vite + React + TypeScript project.",
        "`frontend/tsconfig.json` exists and is valid for a Vite + React + TypeScript project.",
        "A production build completes without configuration-file-not-found errors (e.g., missing Vite/TS config)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Fix the production build-time incompatibility caused by `process.env.II_URL` being referenced in the browser bundle (in the read-only `frontend/src/hooks/useInternetIdentity.ts`) by updating the Vite build configuration to shim/define `process.env.II_URL` at build time using a safe default (e.g., `https://identity.ic0.app`) and/or `import.meta.env.VITE_II_URL`, without editing any immutable hook files.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "try again"
        ]
      },
      "acceptanceCriteria": [
        "The production build does not fail with errors like `process is not defined` or missing `process.env` references.",
        "Internet Identity login still works in production builds using the configured identity provider URL.",
        "No changes are made to immutable paths (including `frontend/src/hooks/useInternetIdentity.ts`)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Run through the full build/deploy verification steps and ensure the deployed app loads successfully, documenting any required environment variables (e.g., `VITE_II_URL`) in `frontend/DEPLOYMENT.md` if additional adjustments were needed.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "try again"
        ]
      },
      "acceptanceCriteria": [
        "A production build succeeds end-to-end.",
        "The deployed frontend loads in the browser without a blank screen or immediate runtime crash.",
        "`frontend/DEPLOYMENT.md` reflects the final, correct deployment prerequisites (including environment variables) if changes were required."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in `backend/main.mo`; do not introduce additional backend services.",
    "Do not edit files in `frontend/immutablePaths` (including `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useActor.ts`, and `frontend/src/main.tsx`).",
    "Use English for all user-facing text."
  ],
  "nonGoals": [
    "Adding new product features unrelated to build/deploy stability.",
    "Refactoring authentication flows beyond what is required to fix the build/deployment.",
    "Changing backend schemas or adding migrations (not requested)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}