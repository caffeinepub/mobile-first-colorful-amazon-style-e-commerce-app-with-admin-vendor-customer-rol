{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Login-only admin gating with AdminBypass and stabilized Admin Dashboard",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Replace SafeAdminGate/role-based guarding on all /admin routes with a login-only AdminBypass wrapper while keeping AdminErrorBoundary.",
      "acceptanceCriteria": [
        "`frontend/src/App.tsx` no longer imports or renders `SafeAdminGate` for `/admin`, `/admin/products`, `/admin/vendors`, and `/admin/orders`.",
        "No admin route uses `RequireRole` (or any `useIsAdmin`/role-check gate) to guard rendering.",
        "All admin pages still render inside `AdminErrorBoundary`."
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Remove `SafeAdminGate` import/usage and wrap `/admin`, `/admin/products`, `/admin/vendors`, `/admin/orders` route components with the new `AdminBypass` (login-only) while keeping `AdminErrorBoundary` as the outer wrapper."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Add AdminBypass component that only checks authentication and redirects unauthenticated users to /customer-login.",
      "acceptanceCriteria": [
        "`AdminBypass` does not import or call any role-checking hooks/utilities (e.g., `useIsAdmin`, `useGetCallerRole`, `RequireRole`, token checks).",
        "When the user is not logged in, navigating to any `/admin*` route redirects to `/customer-login` (existing login page).",
        "When the user is logged in, `AdminBypass` renders its `children` without additional gating.",
        "If auth state is still initializing, `AdminBypass` shows a simple stable loading state (no role verification)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/auth/AdminBypass.tsx",
          "operation": "create",
          "description": "Implement `AdminBypass` as a login-only wrapper using `useInternetIdentity` to determine (a) initializing state and (b) authenticated state; show a minimal, stable loading UI while initializing; redirect unauthenticated users to the `/customer-login` route using TanStack Router navigation; render `children` when authenticated."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Import and use `AdminBypass` for all `/admin*` routes to enforce login-only access and redirect unauthenticated users to `/customer-login`."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Simplify AdminDashboardPage UI to a minimal, stable layout while preserving vendor list, wallet due, and outlet enable/disable mutation behavior.",
      "acceptanceCriteria": [
        "`AdminDashboardPage` continues to: (1) fetch and display vendors, (2) show wallet due, and (3) allow enabling/disabling vendor outlet status via the existing mutation.",
        "The page layout is simplified (no unnecessary gradients/animated/complex decorative wrappers that could contribute to instability); use basic container, headings, and cards/tables with predictable rendering.",
        "No role verification logic is added to `AdminDashboardPage` (it must not check admin role before running).",
        "The dashboard renders without crashing even when vendor list is empty, loading, or mutation errors occur (errors should be handled with existing `toast` messaging and overall `AdminErrorBoundary`)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/admin/AdminDashboardPage.tsx",
          "operation": "modify",
          "description": "Rebuild the dashboard layout to a minimal, predictable structure (simple container + headings + a basic table/list of vendors). Keep existing functionality: fetch vendors, display wallet due, and toggle outlet status via the existing `useUpdateVendor` mutation with `toast` success/error messaging. Ensure stable rendering for loading, empty, and error states; avoid decorative gradients/animations and avoid introducing any role checks."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Remove the `isAdmin`-dependent `enabled` gating in `useGetVendors()` so the vendor list query can run for any authenticated session where an actor is available (no frontend role verification); rely on existing backend behavior for authorization failures and keep the hookâ€™s safe fallback behavior (return empty array on errors)."
        }
      ]
    }
  ]
}