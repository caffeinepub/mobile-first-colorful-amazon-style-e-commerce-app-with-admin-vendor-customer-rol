{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Make QuickBazar fully PWA installable (manifest, icons, service worker, offline caching, A2HS prompt)",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Complete the web app manifest with mobile-first PWA settings (name/short_name, start_url, scope, standalone display, orange theme/background colors, portrait orientation).",
      "acceptanceCriteria": [
        "frontend/public/manifest.webmanifest contains: name, short_name, start_url set to '/', scope set to '/', display set to 'standalone', and explicit theme_color + background_color values.",
        "The theme_color used in the manifest matches the <meta name=\"theme-color\"> value in frontend/index.html.",
        "Manifest icons reference real files under /assets/generated/ with correct sizes/type fields.",
        "PWA continues to prefer portrait usage on mobile (orientation remains portrait-primary or equivalent)."
      ],
      "file_operations": [
        {
          "path": "frontend/public/manifest.webmanifest",
          "operation": "modify",
          "description": "Update the manifest to include scope:'/' and ensure mobile-first PWA fields are complete (name/short_name, start_url:'/', display:'standalone', portrait orientation, and orange marketplace theme_color/background_color). Ensure icon entries reference the generated icon files under /assets/generated/ with correct sizes/type/purpose."
        },
        {
          "path": "frontend/index.html",
          "operation": "modify",
          "description": "Verify <meta name='theme-color'> matches the manifest theme_color value and keep mobile-first PWA meta/link tags aligned with the updated manifest."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Provide a complete installable icon set (including maskable) and wire icons into the manifest and Apple touch metadata for Android Chrome and iOS Safari.",
      "acceptanceCriteria": [
        "frontend/public/manifest.webmanifest includes a multi-size icon set (at least: 192x192 and 512x512) plus at least one maskable icon entry.",
        "frontend/index.html includes an apple-touch-icon link that points to an existing generated PNG (180x180).",
        "All referenced icon files exist in frontend/public/assets/generated/ and are served correctly at runtime (no 404s)."
      ],
      "file_operations": [
        {
          "path": "frontend/public/assets/generated/pwa-icon.dim_72x72.png",
          "operation": "create",
          "description": "Add the generated PWA app icon asset (72x72) at frontend/public/assets/generated/pwa-icon.dim_72x72.png and ensure it is referenced by the manifest where appropriate."
        },
        {
          "path": "frontend/public/assets/generated/pwa-icon.dim_96x96.png",
          "operation": "create",
          "description": "Add the generated PWA app icon asset (96x96) at frontend/public/assets/generated/pwa-icon.dim_96x96.png and ensure it is referenced by the manifest where appropriate."
        },
        {
          "path": "frontend/public/assets/generated/pwa-icon.dim_128x128.png",
          "operation": "create",
          "description": "Add the generated PWA app icon asset (128x128) at frontend/public/assets/generated/pwa-icon.dim_128x128.png and ensure it is referenced by the manifest where appropriate."
        },
        {
          "path": "frontend/public/assets/generated/pwa-icon.dim_144x144.png",
          "operation": "create",
          "description": "Add the generated PWA app icon asset (144x144) at frontend/public/assets/generated/pwa-icon.dim_144x144.png and ensure it is referenced by the manifest where appropriate."
        },
        {
          "path": "frontend/public/assets/generated/pwa-icon.dim_152x152.png",
          "operation": "create",
          "description": "Add the generated PWA app icon asset (152x152) at frontend/public/assets/generated/pwa-icon.dim_152x152.png and ensure it is referenced by the manifest where appropriate."
        },
        {
          "path": "frontend/public/assets/generated/pwa-icon.dim_384x384.png",
          "operation": "create",
          "description": "Add the generated PWA app icon asset (384x384) at frontend/public/assets/generated/pwa-icon.dim_384x384.png and ensure it is referenced by the manifest where appropriate."
        },
        {
          "path": "frontend/public/assets/generated/pwa-maskable.dim_192x192.png",
          "operation": "create",
          "description": "Add the generated maskable PWA app icon asset (192x192) at frontend/public/assets/generated/pwa-maskable.dim_192x192.png and ensure it is referenced by the manifest with purpose:'maskable'."
        },
        {
          "path": "frontend/public/manifest.webmanifest",
          "operation": "modify",
          "description": "Expand the manifest icons array to include a multi-size set (including at least 192x192 and 512x512) and at least one maskable entry. Ensure all icon src values point to existing generated files under frontend/public/assets/generated/ and that sizes/type/purpose fields are correct."
        },
        {
          "path": "frontend/index.html",
          "operation": "modify",
          "description": "Ensure the Apple touch metadata is correctly wired (keep/update the apple-touch-icon link to frontend/public/assets/generated/apple-touch-icon.dim_180x180.png) and verify the file is served correctly at runtime (no 404)."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Keep the service worker enabled and implement offline behavior by caching the app shell for navigations and falling back to offline.html when needed, while avoiding caching authenticated/private responses.",
      "acceptanceCriteria": [
        "The service worker is registered by the app in production builds (no console error; registration succeeds when supported).",
        "When offline, a navigation to the app (e.g., '/') loads a cached app shell if available; otherwise it shows the existing offline fallback page (frontend/public/offline.html).",
        "The service worker caches core static assets (icons + other critical assets already listed) and cleans up old caches on activate.",
        "Offline behavior does not cache or store authenticated/private API responses (continue to avoid caching authenticated requests)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Adjust service worker registration so it runs for production builds (while still safely checking browser support), and keep registration error handling clean (no runtime crashes)."
        },
        {
          "path": "frontend/public/sw.js",
          "operation": "modify",
          "description": "Update service worker caching logic to (1) precache the app shell for navigations, (2) serve cached app shell for navigations when offline if available, otherwise fall back to frontend/public/offline.html, (3) precache the full required icon set, and (4) continue avoiding caching authenticated/private requests and cleaning up old caches on activate."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Implement a mobile-first Add to Home Screen (A2HS) install prompt UX by capturing beforeinstallprompt and showing a non-blocking install CTA that triggers the prompt and hides after installation.",
      "acceptanceCriteria": [
        "On supported Chrome mobile, when the app becomes installable, the UI shows a clear install call-to-action (English text) without blocking normal navigation.",
        "Tapping the install call-to-action triggers the deferred beforeinstallprompt prompt and handles the userâ€™s choice (accepted/dismissed) without errors.",
        "After the app is installed (appinstalled event), the install UI no longer appears.",
        "The install UI is mobile-first (fits small screens and does not overlap core navigation controls excessively, e.g., bottom nav)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useA2HS.ts",
          "operation": "create",
          "description": "Create a hook to capture and manage the beforeinstallprompt and appinstalled events, expose whether the app is installable/installed, and provide an action to trigger the deferred install prompt (English-only UI text will be handled by the consuming component)."
        },
        {
          "path": "frontend/src/components/pwa/A2HSInstallBanner.tsx",
          "operation": "create",
          "description": "Create a mobile-first, non-blocking install banner/button component that uses the useA2HS hook and a standard Button component (do not modify frontend/src/components/ui). The component should fit small screens and avoid overlapping the bottom nav; hide itself when not installable or after installation."
        },
        {
          "path": "frontend/src/components/AppLayout.tsx",
          "operation": "modify",
          "description": "Wire the A2HSInstallBanner into the shared layout so it can appear across main customer pages without blocking navigation and without excessively overlapping the BottomNav on small screens."
        }
      ]
    }
  ]
}